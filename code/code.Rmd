---
title: "Bil code"
author: "Thomas Holm-Weber"
date: "2023-03-28"
output: html_document
---

#Packages
```{r, echo=FALSE}
install.packages("tidyverse", repos = "http://cran.us.r-project.org")
library(tidyverse)
library(ggplot2)
```
No echo
```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


#Data Import Mac
```{r, echo=FALSE}
getwd()
setwd("/Users/thomasholm-weber/Desktop/bil/bil2/data")
bil = read_csv("bil.csv")
```

#Data Import PC
```{r}
getwd()
setwd("H:/PhD RH 2019 - 2022/Prj 4 BILACO/rbil/bil2/data")
bil = read_csv("bil.csv")
```

#Table 1 data
```{r, echo=FALSE}
mean(bil$age_at_doi, na.rm = T)
sd(bil$age_at_doi, na.rm = T)
mean(bil$bp_sys_mean, na.rm = T)
sd(bil$bp_sys_mean, na.rm = T)
mean(bil$bp_mean_dia, na.rm = T)
sd(bil$bp_mean_dia, na.rm = T)
mean(bil$hr_mean, na.rm = T)
sd(bil$hr_mean, na.rm = T)

glimpse(bil$bp_mean_dia)
```

#Subsets disease & rename variables
```{r, echo=FALSE}
bil$disease = recode(bil$disease, "1" = "ba", "2" = "tof", "3" = "cc")
bil$mm_for_estimation_of_cvp = recode(bil$mm_for_estimation_of_cvp, "1" = "Not dilated")
bil$color_for_evaluation_of_ar = recode(bil$color_for_evaluation_of_ar, "1" = "No Aortic Regurgitation")
bil$color_for_estimation_of_pr = recode(bil$color_for_estimation_of_pr, "1" = "No Pulmonal Regurgitation", "2" = "Mild Pulmonal Regurgitation", "3" = "Moderat Pulmonal Regurgitation", "4" = "Severe Pulmonal Regurgitation")
bil$mv_color_interrogation_for = recode(bil$mv_color_interrogation_for, "1" = "No Mitral Valve Regurgitation", "2" = "Mild Mitral Valve Regurgitation")
bil$lrate_diff = bil$lrate - bil$lrate_2

glimpse(bil$lrate_diff)
glimpse(bil$lrate)
glimpse(bil$lrate_2)


ba = bil %>% filter(disease=="ba")
tof = bil %>% filter(disease=="tof")
cc = bil %>% filter(disease=="cc")
```


#ToF table1
```{r}
mean(tof$age_at_doi, na.rm = T)
sd(tof$age_at_doi, na.rm = T)
mean(tof$bp_sys_mean, na.rm = T)
sd(tof$bp_sys_mean, na.rm = T)
mean(tof$bp_mean_dia, na.rm = T)
sd(tof$bp_mean_dia, na.rm = T)
mean(tof$hr_mean, na.rm = T)
sd(tof$hr_mean, na.rm = T)
```


#BA table1
```{r}
mean(ba$age_at_doi, na.rm = T)
sd(ba$age_at_doi, na.rm = T)
mean(ba$bp_sys_mean, na.rm = T)
sd(ba$bp_mean_dia, na.rm = T)
mean(ba$bp_sys_mean, na.rm = T)
sd(ba$bp_sys_mean, na.rm = T)
mean(ba$hr_mean, na.rm = T)
sd(ba$hr_mean, na.rm = T)
```



#NIRF ToF
```{r}
mean(tof$lrate, na.rm = T)
sd(tof$lrate, na.rm = T)
mean(tof$lrate_2, na.rm = T)
sd(tof$lrate_2, na.rm = T)
mean(tof$lpressure, na.rm = T)
sd(tof$lpressure, na.rm = T)
```

#NIRF BA
```{r}
mean(ba$lrate, na.rm = T)
sd(ba$lrate, na.rm = T)
mean(ba$lrate_2, na.rm = T)
sd(ba$lrate_2, na.rm = T)
mean(ba$lpressure, na.rm = T)
sd(ba$lpressure, na.rm = T)
```


#MR ToF
```{r, echo=FALSE}
mean(tof$mritype_agreed, na.rm = T)
```

#MR BA
```{r, echo=FALSE}
mean(ba$mritype_agreed, na.rm = T)
```


#Boxplot LP
```{r, echo=FALSE}
ggplot(bil, aes(x = disease, y = lpressure)) +
  geom_boxplot() +
  labs(x = "disease", y = "lpressure") + theme_bw()

```


#Boxplot LR
```{r, echo=FALSE}
ggplot(bil, aes(x = disease, y = lrate)) +
  geom_boxplot() +
  labs(x = "disease", y = "lrate") + theme_bw()
```


#Boxplot LR2
```{r, echo=FALSE}
ggplot(bil, aes(x = disease, y = lrate_2)) +
  geom_boxplot() +
  labs(x = "disease", y = "lrate2") + theme_bw()

```


#ToFresultstable
```{r}
tofresults <- tof %>% 
  select(fp_nr, mritype_agreed, lrate,lrate_2,lpressure, color_for_estimation_of_pr, mm_for_estimation_of_cvp, mm_lateral_tv_annulus_for, years_with_pr, ef)

tofresults

write.csv(tofresults, "tofresults.csv")
```

#correlationstof
```{r}
correlationlr1mri <- tof %>%
  summarize(correlationlr1mri = cor(mritype_agreed, lrate, use = "complete.obs"))

print(correlationlr1mri)

correlationlr2mri <- tof %>%
  summarize(correlationlr1mri = cor(mritype_agreed, lrate_2, use = "complete.obs"))

print(correlationlr2mri)

correlationlrdiffmri <- tof %>%
  summarize(correlationlr1mri = cor(mritype_agreed, lrate_diff, use = "complete.obs"))

print(correlationlrdiffmri)


correlationlpmri <- tof %>%
  summarize(correlationlr1mri = cor(mritype_agreed, lpressure, use = "complete.obs"))

print(correlationlpmri)

tof <- tof %>%
  mutate(
    PR_numeric = as.numeric(as.character(color_for_estimation_of_pr))
  )

correlationprmri <- tof %>%
  summarize(correlationlr1mri = cor(mritype_agreed, PR_numeric, use = "complete.obs"))

print(correlationprmri)

```


#baresultstable
```{r}
baresults <- ba %>% 
  select(fp_nr, mritype_agreed, lrate,lrate_2,lpressure, color_for_estimation_of_pr, mm_for_estimation_of_cvp, mm_lateral_tv_annulus_for, years_with_pr, ef)

baresults

write.csv(tofresults, "baresults.csv")
```

